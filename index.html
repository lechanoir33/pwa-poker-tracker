<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Poker Tracker</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>Suivi des Mains de Poker</h1>

  <button id="resetButton">Réinitialiser</button>

  <table id="statsTable">
    <thead>
      <tr>
        <th>Main</th>
        <th>Cocher ?</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <!-- Placer le script ici, avant la balise de fermeture </body> -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Lorsque le DOM est prêt, on peut ajouter l'écouteur
      document.getElementById('resetButton').addEventListener('click', function() {
        // Réinitialiser uniquement les mains sélectionnées
        localStorage.removeItem('selectedHands');  // Réinitialise 'selectedHands' dans localStorage

        // Réinitialiser les compteurs des mains sélectionnées sur la page index
        const selectedHandCounts = {};  // On vide les comptages des mains sélectionnées

        // Ce code ne touche pas à 'handSessions' et ne réinitialise pas l'historique des sessions
        console.log('Les mains sélectionnées ont été réinitialisées.');

        // Optionnel : recharge la page pour réinitialiser visuellement les données
        location.reload();  // Cela permettra de vider l'affichage des mains sélectionnées
      });

      // Récupérer et afficher les données dans la table Stats
      const tbody = document.querySelector('#statsTable tbody');
      const sessionData = JSON.parse(localStorage.getItem('handSessions')) || [];

      sessionData.slice().reverse().forEach(session => {
        const dateRow = document.createElement('tr');
        dateRow.innerHTML = `<td colspan="2" class="session-title">${session.date}</td>`;
        tbody.appendChild(dateRow);

        session.hands.forEach(entry => {
          const row = document.createElement('tr');

          const handCell = document.createElement('td');
          const count = getSelectedHandCounts()[entry.hand] || 1;
          handCell.innerHTML = count > 1
            ? `${entry.hand}<sup style="color:red;">${count}</sup>`
            : entry.hand;

          const checkedCell = document.createElement('td');
          checkedCell.textContent = entry.checked ? '✔️' : '❌';

          row.appendChild(handCell);
          row.appendChild(checkedCell);
          tbody.appendChild(row);
        });
      });
    });

    // Fonction pour récupérer les comptes des mains sélectionnées depuis le localStorage
    function getSelectedHandCounts() {
      const raw = localStorage.getItem('selectedHands');
      const counts = {};

      try {
        const hands = JSON.parse(raw) || [];
        hands.forEach(entry => {
          const key = entry.hand;
          counts[key] = (counts[key] || 0) + 1;
        });
      } catch (e) {
        return {};
      }

      return counts;
    }
  </script>
</body>
</html>
