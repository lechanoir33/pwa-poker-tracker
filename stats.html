<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Stats des Mains Reportées</title>
<style>
  body {
    background-color: #111;
    color: white;
    font-family: Arial, sans-serif;
    padding: 20px;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 20px;
  }
  th, td {
    border: 1px solid white;
    padding: 8px;
    text-align: center;
  }
  th {
    background-color: #333;
  }
  sup {
    color: #ffcc00;
    font-size: 0.8em;
  }
  .session-title {
    text-align: left;
    font-weight: bold;
    font-size: 1.2em;
    padding-top: 20px;
    color: #0ff;
  }
  a {
    color: #0af;
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>
</head>
<body>

<h1>Stats des Mains Reportées</h1>
<a href="index.html">← Retour</a>

<table id="statsTable">
  <thead>
    <tr><th>Main</th><th>Occurrences</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  // Récupérer l'historique complet depuis localStorage
  function getHandHistory() {
    const raw = localStorage.getItem('handHistory');
    return raw ? JSON.parse(raw) : {};
  }

  // Enregistrer l'historique complet dans localStorage
  function saveHandHistory(history) {
    localStorage.setItem('handHistory', JSON.stringify(history));
  }

  // Retourne la date au format YYYY-MM-DD (date du jour)
  function getCurrentDateKey() {
    return new Date().toISOString().slice(0, 10);
  }

  // Ajoute une main à la session de la date du jour
  function addHand(hand) {
    const history = getHandHistory();
    const dateKey = getCurrentDateKey();
    if (!history[dateKey]) {
      history[dateKey] = {};
    }
    if (history[dateKey][hand]) {
      history[dateKey][hand]++;
    } else {
      history[dateKey][hand] = 1;
    }
    saveHandHistory(history);
  }

  // Exemple pour tester : ajouter quelques mains (à remplacer par appel réel)
  // addHand('AA');
  // addHand('KK');
  // addHand('AA');

  // Trie les mains selon leur classement défini
  const handRanking = [
    'AA','KK','AKs','QQ','JJ','AKo','AQs','AQo','AJs','TT','KQs','ATs','KJs','AJo','QJs',
    '99','JTs','KTs','QTs','88','KQo','A9s','T9s','Q9s','KJo','A8s','A7s','J9s',
    'A5s','A6s','T8s','A4s','QJo','K9s','J8s','A3s','KTo','Q8s','A2s',
    'J7s','Q7s','K8s','98s','97s','87s','T7s','Q6s','JTo','K7s','J6s','76s','QTo','K6s',
    'J5s','K5s','J4s','K4s','K3s','65s','K2s','T6s','Q5s','Q4s','T5s','T4s','Q3s','54s',
    'J3s','Q2s','J2s','T3s','T2s','43s','42s','32s','A9o','A8o','A7o','A5o','A6o','A4o',
    'A3o','A2o','K9o','K8o','K7o','K6o','K5o','K4o','K3o','K2o','Q9o','Q8o','Q7o','Q6o',
    'Q5o','Q4o','Q3o','Q2o','J9o','J8o','J7o','J6o','J5o','J4o','J3o','J2o','T9o','T8o',
    'T7o','T6o','T5o','T4o','T3o','T2o','98o','97o','96o','95o','94o','93o','92o','87o',
    '86o','85o','84o','83o','82o','76o','75o','74o','73o','72o','65o','64o','63o','62o',
    '54o','53o','52o','43o','42o','32o','77','66','55','44','33','22'
  ];

  // Trie un objet {hand: occurrence} selon le classement
  function sortHands(handsObj) {
    return Object.entries(handsObj).sort((a,b) => {
      const iA = handRanking.indexOf(a[0]);
      const iB = handRanking.indexOf(b[0]);
      if (iA === -1 && iB === -1) return 0;
      if (iA === -1) return 1;
      if (iB === -1) return -1;
      return iA - iB;
    });
  }

  // Affiche tout l'historique (toutes les dates)
  function displayHistory() {
    const history = getHandHistory();
    const tbody = document.querySelector('#statsTable tbody');
    tbody.innerHTML = '';

    // On affiche les sessions triées par date décroissante (plus récent en haut)
    const sortedDates = Object.keys(history).sort((a,b) => b.localeCompare(a));

    sortedDates.forEach(date => {
      // Titre de session
      const trTitle = document.createElement('tr');
      const tdTitle = document.createElement('td');
      tdTitle.colSpan = 2;
      tdTitle.textContent = `Session du ${date}`;
      tdTitle.classList.add('session-title');
      trTitle.appendChild(tdTitle);
      tbody.appendChild(trTitle);

      // Mains triées pour cette session
      const sortedHands = sortHands(history[date]);

      sortedHands.forEach(([hand, count]) => {
        const tr = document.createElement('tr');
        const tdHand = document.createElement('td');
        tdHand.textContent = hand;
        const tdCount = document.createElement('td');
        tdCount.innerHTML = `${count} <sup>x</sup>`;
        tr.appendChild(tdHand);
        tr.appendChild(tdCount);
        tbody.appendChild(tr);
      });
    });
  }

  // Affiche l'historique au chargement
  displayHistory();

</script>

</body>
</html>

